
@{
    ViewData["Title"] = "Login";
}

<div class="container mt-5">
    <h2 class="text-center">Login</h2>
    <div data-bind="with: loginViewModel">
        <form>
            <div class="form-group">
                <label for="Email">Email Address</label>
                <input type="email" class="form-control" id="Email" data-bind="value: email" placeholder="Enter your email" required />
            </div>

            <div class="form-group mt-3">
                <label for="Password">Password</label>
                <input type="password" class="form-control" id="Password" data-bind="value: password" placeholder="Enter your password" required />
            </div>

            <!-- Button now explicitly triggers the loginUser function -->
            <button type="button" class="btn btn-primary mt-4 w-100" data-bind="click: loginUser">Login</button>
        </form>

        <div class="text-center mt-3">
            <p data-bind="text: errorMessage, visible: errorMessage" class="text-danger"></p>
        </div>
    </div>
</div>




<!-- Include jQuery library (place this before your custom scripts) -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/knockout@3.5.1/build/output/knockout-latest.js"></script>

<script>
    function LoginViewModel() {
        var self = this;

        // Observables for form fields
        self.email = ko.observable("");
        self.password = ko.observable("");
        self.errorMessage = ko.observable("");

        // Login function
        self.loginUser = function () {
            self.errorMessage(""); // Clear any previous error message

            // Validate form inputs
            if (!self.email() || !self.password()) {
                self.errorMessage("Both email and password are required.");
                return;
            }

            // Perform AJAX POST request to login API
            $.ajax({
                url: "/User/Login/Login", // Backend login API endpoint
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({
                    Email: self.email(),
                    Password: self.password()
                }),
                success: function (response) {
                    // Redirect to task page on successful login
                    window.location.href = "/Task/Viewtask"; // Change this URL to your desired route
                },
                error: function (xhr) {
                    // Show error message
                    self.errorMessage(xhr.responseText || "Login failed. Please try again.");
                }
            });
        };
    }

    // Apply bindings after DOM is ready
    $(document).ready(function () {
        ko.applyBindings({ loginViewModel: new LoginViewModel() });
    });
</script>
